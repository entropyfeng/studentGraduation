<title>学生信息</title>

<div class="layui-card layadmin-header">
    <div class="layui-breadcrumb" lay-filter="breadcrumb">
        <a lay-href="">主页</a>
        <a><cite>学生管理</cite></a>
        <a><cite>学生信息</cite></a>
    </div>
</div>

<div class="layui-fluid">
    <div class="layui-card">
        <div class="layui-form layui-card-header layuiadmin-card-header-auto"
             lay-filter="graduation-studentInformation-formlist">
            <div class="layui-form-item">
                <div class="layui-inline">
                    <label class="layui-form-label">学号</label>
                    <div class="layui-input-block">
                        <input type="text" name="studentId" placeholder="请输入" autocomplete="off" class="layui-input">
                    </div>
                </div>
                <div class="layui-inline">
                    <label class="layui-form-label">姓名</label>
                    <div class="layui-input-block">
                        <input type="text" name="studentName" placeholder="请输入" autocomplete="off" class="layui-input">
                    </div>
                </div>


                <div class="layui-inline">
                    <button class="layui-btn layuiadmin-btn-useradmin" lay-submit lay-filter="student-front-search">
                        <i class="layui-icon layui-icon-search layuiadmin-button-btn"></i>
                    </button>
                </div>
            </div>
        </div>

        <div class="layui-card-body">
            <div style="padding-bottom: 10px;">
                <button class="layui-btn layuiadmin-btn-useradmin" data-type="batchdel">删除</button>
                <button class="layui-btn layuiadmin-btn-useradmin" data-type="add">添加</button>
            </div>

            <table id="student-information" lay-filter="student-information"></table>

            <script type="text/html" id="student-information-bar">

                <a class="layui-btn layui-btn-normal layui-btn-xs" lay-event="view"><i
                        class="layui-icon layui-icon-edit"></i>查看</a>
                <a class="layui-btn layui-btn-normal layui-btn-xs" lay-event="edit"><i
                        class="layui-icon layui-icon-edit"></i>编辑</a>
                <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del"><i
                        class="layui-icon layui-icon-delete"></i>删除</a>
            </script>
        </div>
    </div>
</div>

<script>



    layui.use(['table', 'form','upload'], function(){
        var $ = layui.$
            ,admin = layui.admin
            ,view = layui.view
            ,table = layui.table
            ,form = layui.form
            ,setter=layui.setter
            ,upload = layui.upload
            ,true_url=layui.setter.true_url
            , jwt=layui.data(setter.tableName)['jwt'];
        //用户管理
        table.render({
            elem: '#student-information'
            ,url: true_url+'/getStudentInformation/condition' //向服务器请求接口
            ,method:'get'
            ,headers:{
                "jwt":jwt
            }
            ,parseData:function (res) {
                var meta=res['meta'];
                var data=res['data'];
                return {
                    "code":0
                    ,"data":data['students']
                    ,"msg":meta['msg']
                    ,"count":data['count']

                }
            }


            ,cols: [[
                {type: 'checkbox', fixed: 'left'}
                ,{field: 'studentId', width: 100, title: '学号', sort: true}
                ,{field: 'studentName', title: '姓名', minWidth: 100}
                ,{field: 'studentSex', title: '性别', minWidth: 20,templet: function (d) {
                        return d.studentSex==0?'男':'女';
                    }}
               /* ,{field:'studentPhoto',title:'图片', templet:function (d) {
                        var finalUrl=d.studentPhoto+"&jwt="+jwt;
                        return "  <img style=\"display: inline-block; width: 100%; height: 100%;\" src="+finalUrl+" >";
                    }}*/
                ,{field: 'graduationYear', title: '毕业时间', width: 100}
                ,{field: 'collegeName', title: '学院'}
                ,{field: 'specialtyName', title: '专业'}
                ,{field: 'className', title: '班级'}
                ,{field: 'idCardNum', title: '身份证号'}
                ,{field: 'email', title: '邮箱'}
                ,{title: '操作', width: 150, align:'center', fixed: 'right', toolbar: '#student-information-bar'}
            ]]
            ,page: true
            ,height: 'full-320'
            ,text: '对不起，加载出现异常！'
        });

        //监听搜索
        form.on('submit(student-front-search)', function(data){
            var field = data.field;
            //执行重载
            table.reload('student-information', {
                where: field
            });
        });

        //监听工具条
        table.on('tool(student-information)', function(obj){
            var data = obj.data;
            if(obj.event === 'del'){
                layer.prompt({
                    formType: 1
                    ,title: '敏感操作，请验证口令'
                }, function(value, index){
                    layer.close(index);

                    layer.confirm('真的删除行么', function(index){
                        obj.del();
                        layer.close(index);
                    });
                });
            }else if(obj.event==='view'){
                admin.popup({
                    title:'详细信息'
                    ,id:'view-detail-information'
                    ,success: function (layero,index) {
                        view(this.id).render('students/view-student-information',data);

                    }

                });

            } else if(obj.event === 'edit'){
                admin.popup({
                    title: '编辑用户'
                    ,area: ['500px', '450px']
                    ,id: 'LAY-popup-user-add'
                    ,success: function(layero, index){

                        view(this.id).render('students/edit-student-information',data).done(function () {
                            upload.render({
                                elem: '#image' //绑定元素
                                ,url: true_url+'/student/photo/upload' //上传接口
                                ,accept:'images'
                                ,method:'post'
                                ,headers:{
                                    jwt:jwt
                                }
                                ,data:{
                                    'studentId':data.studentId
                                }
                                ,before:function (obj) {
                                    layer.load();
                                }
                                ,done: function(res){
                                    //上传完毕回调
                                    var meta=res['meta'];
                                    if(meta['code']==6666){
                                        layer.closeAll('loading');
                                        layer.msg('上传成功');
                                    }else {
                                        layer.closeAll('loading');
                                        layer.msg('上传失败');
                                    }
                                }
                                ,error: function(){
                                    //请求异常回调
                                    layer.closeAll('loading');
                                    layer.msg('上传失败');
                                }
                            });



                        });


           /*             view(this.id).render('students/studentform', data).done(function(){
                         //   form.render(null, 'student-info-form');

                            //监听提交
                            /!*       form.on('submit(LAY-user-front-submit)', function(data){
                                       var field = data.field; //获取提交的字段

                                       //提交 Ajax 成功后，关闭当前弹层并重载表格
                                       //$.ajax({});
                                       layui.table.reload('LAY-user-manage'); //重载表格
                                       layer.close(index); //执行关闭
                                   });*!/
                        });*/
                    }

                });
            }
        });
    });

</script>